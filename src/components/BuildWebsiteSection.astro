---
import { PenLine, Monitor, Mail } from "@lucide/astro";
import { getT, type Locale } from "../i18n";

interface StepItem {
  title: string;
  text: string;
  icon?: any;
}

interface Props {
  title?: string;
  desc?: string;
  items?: StepItem[];
  image?: { src: string; alt?: string };
  id?: string;
  lang?: Locale;
}

const {
  title,
  desc,
  items,
  image = {
    src: "https://burst.shopifycdn.com/photos/coding-on-laptop.jpg?width=1000&format=pjpg&exif=0&iptc=0",
    alt: "Hero",
  },
  id = "build-website",
  lang = "hr",
}: Props = Astro.props;

const t = getT(lang);
const i18n = t.sections?.buildWebsite as
  | { title: string; desc: string; items: { title: string; desc: string }[] }
  | undefined;

const finalTitle = title ?? i18n?.title ?? "";
const finalDesc = desc ?? i18n?.desc ?? "";
const finalItems: StepItem[] = (
  items ??
  i18n?.items?.map((it) => ({
    title: it.title,
    text: it.desc,
  })) ??
  []
).map((it, idx) => ({
  ...it,
  icon: idx === 0 ? PenLine : idx === 1 ? Monitor : Mail,
}));
---

<section id={id} class="build relative mx-auto overflow-hidden px-4 py-16 md:px-6">
  <div class="relative mx-auto grid max-w-7xl gap-8 md:grid-cols-2">
    <div class="build__glow" aria-hidden="true" />
    <!-- Left: Image with purple overlay fade -->
    <div class="build-media relative min-h-85 md:min-h-140 rounded-xl overflow-hidden">
      <img
        src={image.src}
        alt={image.alt ?? ""}
        class="absolute inset-0 h-full w-full object-cover"
      />

      <!-- subtle vignette at bottom right -->
      <div
        class="build-media__vignette absolute right-0 bottom-0 h-48 w-48 translate-x-16 translate-y-16 rounded-full blur-2xl"
      >
      </div>
    </div>

    <!-- Right: Content -->
    <div class="build-card relative rounded-xl p-6 md:p-8">
      <div
        class="build-card__dot absolute -top-5 left-6 h-10 w-10 rounded-full"
      >
      </div>

      <h2 class="build-title text-3xl font-bold">{finalTitle}</h2>
      <p class="build-desc mt-4">{finalDesc}</p>

      <div class="mt-10 space-y-10">
        {
          finalItems.map((it: StepItem, i: number) => {
            const Icon = it.icon ?? PenLine;
            const label = it.title || ` ${String(i + 1).padStart(2, "0")} `;
            const isLast = i === finalItems.length - 1;
            return (
              <div class="grid grid-cols-[44px_1fr] gap-4 items-start">
                <div class="flex flex-col items-center">
                  <Icon class="build-step__icon h-7 w-7" />
                  {!isLast && <div class="build-step__line mt-3 h-16 w-px" />}
                </div>
                <div>
                  <span class="build-step__badge inline-block rounded px-3 py-1 text-xs font-semibold">
                    {label}
                  </span>
                  <p class="build-step__text mt-3">{it.text}</p>
                </div>
              </div>
            );
          })
        }
      </div>
    </div>
  </div>
</section>
